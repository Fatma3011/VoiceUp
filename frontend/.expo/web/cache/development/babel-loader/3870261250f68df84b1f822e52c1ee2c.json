{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\Rania Dhahbi\\\\Desktop\\\\VoiceUp-nourhene\\\\VoiceUp-nourhene\\\\frontend\\\\src\\\\screens\\\\Interface.js\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport { Audio } from \"expo-av\";\nimport { useState, useRef } from \"react\";\nimport { audioSave } from \"../services/audio.services\";\nimport Logo from \"../components/Logo\";\nimport BackButton from \"../components/BackButton\";\nimport Background from \"../components/Background\";\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: 'center',\n    backgroundColor: '#ecf0f1',\n    padding: 8\n  },\n  record: {\n    alignItems: 'center',\n    justifyContent: 'center',\n    borderRadius: 15,\n    backgroundColor: 'black',\n    marginBottom: 9,\n    width: 200,\n    height: 30\n  },\n  image: {\n    width: 24,\n    height: 24\n  },\n  barre: {\n    backgroundColor: '#560CCE'\n  }\n});\n\nfunction Interface(_ref) {\n  var _this = this;\n\n  var route = _ref.route,\n      navigation = _ref.navigation;\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      recording = _useState2[0],\n      setRecording = _useState2[1];\n\n  var AudioPlayer = useRef(new Audio.Sound());\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      IsPLaying = _useState4[0],\n      SetIsPLaying = _useState4[1];\n\n  var _useState5 = useState(''),\n      _useState6 = _slicedToArray(_useState5, 2),\n      URI = _useState6[0],\n      setUri = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      messages = _useState8[0],\n      setMessages = _useState8[1];\n\n  var _useState9 = useState(0),\n      _useState10 = _slicedToArray(_useState9, 2),\n      Id = _useState10[0],\n      setId = _useState10[1];\n\n  var user_id = route.params.idu;\n  var talk_to_id = route.params.idf;\n\n  function startRecording() {\n    var _recording;\n\n    return _regeneratorRuntime.async(function startRecording$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            console.log('Requesting Submission ....');\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(Audio.requestPermissionsAsync());\n\n          case 4:\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(Audio.setAudioModeAsync({\n              allowsRecordingIOS: true,\n              playsInSilentModeIOS: true\n            }));\n\n          case 6:\n            console.log('start recording');\n            _recording = new Audio.Recording();\n            _context.next = 10;\n            return _regeneratorRuntime.awrap(_recording.prepareToRecordAsync(Audio.RECORDING_OPTIONS_PRESET_HIGH_QUALITY));\n\n          case 10:\n            _context.next = 12;\n            return _regeneratorRuntime.awrap(_recording.startAsync());\n\n          case 12:\n            setRecording(_recording);\n            console.log('Recording started ...');\n            _context.next = 19;\n            break;\n\n          case 16:\n            _context.prev = 16;\n            _context.t0 = _context[\"catch\"](0);\n            console.error('Failed to start recording ', _context.t0);\n\n          case 19:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 16]], Promise);\n  }\n\n  function stopRecording() {\n    var uri;\n    return _regeneratorRuntime.async(function stopRecording$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            console.log('Stop recording ');\n            setRecording(undefined);\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(recording.stopAndUnloadAsync());\n\n          case 4:\n            uri = recording.getURI();\n            console.log(\"Recording stopped and stored at \", uri);\n            setUri(uri);\n            setMessages([].concat(_toConsumableArray(messages), [{\n              id: Id,\n              Uri: uri,\n              type: \"out\",\n              time: new Date().toLocaleString('en-GB', {\n                timeZone: 'UTC'\n              })\n            }]));\n            setId(Id + 1);\n            console.log(uri);\n            audioSave(uri, user_id, talk_to_id).then(function (response) {\n              console.log(\"success\");\n              console.log(response);\n            }).catch(function (e) {\n              console.log(\"error\");\n            });\n\n          case 11:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  var PlayRecordedAudio = function PlayRecordedAudio(UR) {\n    var playerStatus;\n    return _regeneratorRuntime.async(function PlayRecordedAudio$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(AudioPlayer.current.loadAsync({\n              uri: UR\n            }, {}, true));\n\n          case 3:\n            _context3.next = 5;\n            return _regeneratorRuntime.awrap(AudioPlayer.current.getStatusAsync());\n\n          case 5:\n            playerStatus = _context3.sent;\n\n            if (playerStatus.isLoaded) {\n              if (playerStatus.isPlaying === false) {\n                AudioPlayer.current.playAsync();\n                SetIsPLaying(true);\n              }\n            }\n\n            _context3.next = 12;\n            break;\n\n          case 9:\n            _context3.prev = 9;\n            _context3.t0 = _context3[\"catch\"](0);\n            console.log(_context3.t0);\n\n          case 12:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 9]], Promise);\n  };\n\n  var StopPlaying = function StopPlaying() {\n    var playerStatus;\n    return _regeneratorRuntime.async(function StopPlaying$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(AudioPlayer.current.getStatusAsync());\n\n          case 3:\n            playerStatus = _context4.sent;\n\n            if (!(playerStatus.isLoaded === true)) {\n              _context4.next = 7;\n              break;\n            }\n\n            _context4.next = 7;\n            return _regeneratorRuntime.awrap(AudioPlayer.current.unloadAsync());\n\n          case 7:\n            SetIsPLaying(false);\n            _context4.next = 13;\n            break;\n\n          case 10:\n            _context4.prev = 10;\n            _context4.t0 = _context4[\"catch\"](0);\n            console.log(_context4.t0);\n\n          case 13:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 10]], Promise);\n  };\n\n  var onpress = function onpress(rec) {\n    SetIsPLaying(false);\n\n    if (IsPLaying) {\n      StopPlaying();\n    } else PlayRecordedAudio(rec);\n  };\n\n  return React.createElement(View, {\n    style: {\n      flex: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 1\n    }\n  }, React.createElement(TouchableOpacity, {\n    onPress: function onPress() {\n      return navigation.navigate('FriendsList', {\n        id: user_id\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 1\n    }\n  }, React.createElement(Image, {\n    style: styles.image,\n    source: require(\"../assets/arrow_back.png\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 1\n    }\n  })), React.createElement(View, {\n    style: {\n      height: \"6%\",\n      justifyContent: 'center',\n      alignItems: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 1\n    }\n  }, React.createElement(Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 3\n    }\n  }, React.createElement(\"b\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 9\n    }\n  }, route.params.user))), React.createElement(View, {\n    style: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 1\n    }\n  }, messages.length > 0 ? React.createElement(React.Fragment, null, React.createElement(View, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 11\n    }\n  }, messages.map(function (record) {\n    return React.createElement(View, {\n      key: record.id,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 38\n      }\n    }, React.createElement(Text, {\n      style: {\n        color: \"black\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 61\n      }\n    }, record.time), React.createElement(View, {\n      style: styles.record,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 15\n      }\n    }, React.createElement(View, {\n      style: {\n        borderRadius: 12\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 19\n      }\n    }, React.createElement(Button, {\n      color: \"#560CCE\",\n      title: \"\",\n      onPress: function onPress() {\n        return onpress(record.Uri);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 23\n      }\n    }))));\n  }))) : React.createElement(Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 8\n    }\n  }, \"Say Hello!\")), React.createElement(View, {\n    style: {\n      position: 'absolute',\n      left: 0,\n      right: 0,\n      bottom: 0\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 1\n    }\n  }, React.createElement(Button, {\n    color: \"#560CCE\",\n    title: recording ? 'Stop Recording' : 'Start Recording',\n    onPress: recording ? stopRecording : startRecording,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 1\n    }\n  })));\n}\n\nexport default Interface;","map":{"version":3,"sources":["C:/Users/Rania Dhahbi/Desktop/VoiceUp-nourhene/VoiceUp-nourhene/frontend/src/screens/Interface.js"],"names":["React","Audio","useState","useRef","audioSave","Logo","BackButton","Background","styles","StyleSheet","create","container","flex","justifyContent","backgroundColor","padding","record","alignItems","borderRadius","marginBottom","width","height","image","barre","Interface","route","navigation","recording","setRecording","AudioPlayer","Sound","IsPLaying","SetIsPLaying","URI","setUri","messages","setMessages","Id","setId","user_id","params","idu","talk_to_id","idf","startRecording","console","log","requestPermissionsAsync","setAudioModeAsync","allowsRecordingIOS","playsInSilentModeIOS","Recording","prepareToRecordAsync","RECORDING_OPTIONS_PRESET_HIGH_QUALITY","startAsync","error","stopRecording","undefined","stopAndUnloadAsync","uri","getURI","id","Uri","type","time","Date","toLocaleString","timeZone","then","response","catch","e","PlayRecordedAudio","UR","current","loadAsync","getStatusAsync","playerStatus","isLoaded","isPlaying","playAsync","StopPlaying","unloadAsync","onpress","rec","navigate","require","user","length","map","color","position","left","right","bottom"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport {View,Text, Button,StyleSheet,Image,TouchableOpacity} from \"react-native\";\r\nimport {Audio} from \"expo-av\";\r\nimport { useState,useRef } from \"react\";\r\nimport { audioSave } from '../services/audio.services';\r\nimport Logo from '../components/Logo'\r\nimport BackButton from '../components/BackButton'\r\nimport Background from '../components/Background'\r\n\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n      flex: 1,\r\n      justifyContent: 'center',\r\n      backgroundColor: '#ecf0f1',\r\n      padding: 8,\r\n    },\r\n    record :{\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    borderRadius:15,\r\n    backgroundColor: 'black',\r\n    marginBottom:9,\r\n    width: 200, \r\n    height: 30,\r\n      },\r\n      image: {\r\n        width: 24,\r\n        height: 24,\r\n      },\r\n      barre:{\r\n        backgroundColor:'#560CCE',\r\n      }\r\n\r\n  });\r\n\r\n\r\nfunction Interface({ route, navigation }){\r\n    const [recording, setRecording]=useState();\r\n    const AudioPlayer = useRef(new Audio.Sound());\r\n    const [IsPLaying, SetIsPLaying] = useState(false);\r\n    const [URI, setUri]=useState('');\r\n    const [messages,setMessages]=useState([/*{\r\n        id: 1000,Uri:\"\", type:\"in\"\r\n    }*/])\r\n    const [Id,setId]=useState(0)\r\n\r\n    const user_id=route.params.idu;//à modifier\r\n    const talk_to_id=route.params.idf//à modifier\r\n    async function startRecording(){\r\n      try{\r\n\r\n        console.log('Requesting Submission ....')\r\n        await Audio.requestPermissionsAsync();\r\n        await Audio.setAudioModeAsync({\r\n\r\n            allowsRecordingIOS:true, playsInSilentModeIOS:true\r\n        });\r\n        console.log('start recording')\r\n        const recording=new Audio.Recording();\r\n        await recording.prepareToRecordAsync(Audio.RECORDING_OPTIONS_PRESET_HIGH_QUALITY);\r\n        await recording.startAsync();\r\n        setRecording(recording)\r\n        console.log('Recording started ...');\r\n\r\n      } catch(err){\r\n\r\n        console.error('Failed to start recording ',err)\r\n      }\r\n\r\n    }\r\n    async function stopRecording(){\r\n\r\n        console.log('Stop recording ');\r\n        setRecording(undefined);\r\n        await recording.stopAndUnloadAsync();\r\n        const uri=recording.getURI();\r\n        console.log(\"Recording stopped and stored at \",uri);\r\n        setUri(uri);\r\n         setMessages([... messages,{\r\n             id: Id,Uri:uri, type:\"out\",time:new Date().toLocaleString('en-GB', { timeZone: 'UTC' })\r\n         }])\r\n        setId(Id+1)\r\n       // console.log(messages)\r\n        console.log(uri);\r\n          audioSave(uri,user_id,talk_to_id).then((response)=>{console.log(\"success\");console.log(response)})\r\n                        .catch((e)=>{console.log(\"error\");})\r\n    }\r\n\r\n\r\n    const PlayRecordedAudio = async (UR) => {\r\n        try {\r\n          // Load the Recorded URI\r\n          await AudioPlayer.current.loadAsync({ uri: UR}, {}, true);\r\n          // Get Player Status\r\n          const playerStatus = await AudioPlayer.current.getStatusAsync();\r\n    \r\n          // Play if song is loaded successfully\r\n          if (playerStatus.isLoaded) {\r\n            if (playerStatus.isPlaying === false) {\r\n              AudioPlayer.current.playAsync();\r\n              SetIsPLaying(true);\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.log(error);\r\n        }\r\n      };\r\n      // Function to stop the playing audio\r\n  const StopPlaying = async () => {\r\n    try {\r\n      //Get Player Status\r\n      const playerStatus = await AudioPlayer.current.getStatusAsync();\r\n\r\n      // If song is playing then stop it\r\n      if (playerStatus.isLoaded === true)\r\n        await AudioPlayer.current.unloadAsync();\r\n\r\n      SetIsPLaying(false);\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n const onpress=(rec)=>{\r\n   SetIsPLaying(false);\r\n       if(IsPLaying)\r\n       {StopPlaying()}\r\n       else\r\n       PlayRecordedAudio(rec)\r\n  }\r\nreturn(\r\n\r\n<View style={{flex: 1}} >\r\n<TouchableOpacity onPress={() => navigation.navigate('FriendsList',{id:user_id})}>\r\n<Image\r\n        style={styles.image}\r\n        source={require('../assets/arrow_back.png')}\r\n      /></TouchableOpacity>\r\n<View style={{height:\"6%\",justifyContent: 'center', alignItems:\"center\"}}>\r\n  <Text><b>{route.params.user}</b></Text>\r\n</View>\r\n<View style={styles.container}>\r\n\r\n{messages.length > 0 ? (\r\n        <>\r\n          <View>\r\n          {messages.map((record) => (< View key={record.id}><Text style={{color:\"black\"}}  >{record.time}</Text>\r\n              <View style={styles.record} >\r\n                  <View  style={{borderRadius:12}}>\r\n                      <Button color=\"#560CCE\" title=\"\" onPress={()=>onpress(record.Uri)}></Button>\r\n                  </View>\r\n              </View></View>)  \r\n               \r\n          )}\r\n          </View>\r\n        </>\r\n      ) : (\r\n       <Text>Say Hello!</Text>\r\n      )}\r\n     \r\n\r\n</View>\r\n<View style={{position: 'absolute', left: 0, right: 0, bottom: 0}}>\r\n<Button color=\"#560CCE\" title={recording?'Stop Recording':'Start Recording'}\r\n    onPress={recording ? stopRecording :startRecording }>\r\n   \r\n</Button>\r\n</View>\r\n</View>\r\n\r\n);\r\n}\r\nexport default Interface;\r\n"]},"metadata":{},"sourceType":"module"}